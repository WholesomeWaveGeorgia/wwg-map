<html><head><link rel="import" href="../../bower_components/polymer/polymer-element.html"><link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html"><link rel="import" href="../../bower_components/google-apis/google-maps-api.html"><link rel="import" href="../../bower_components/polymer/lib/elements/dom-if.html"><link rel="prefetch" href="../../bower_components/polymer/lib/mixins/element-mixin.html"><link rel="prefetch" href="../../bower_components/polymer/lib/utils/boot.html"><link rel="prefetch" href="../../bower_components/polymer/lib/utils/settings.html"><link rel="prefetch" href="../../bower_components/polymer/lib/utils/resolve-url.html"><link rel="prefetch" href="../../bower_components/polymer/lib/utils/mixin.html"><link rel="prefetch" href="../../bower_components/polymer/lib/utils/case-map.html"><link rel="prefetch" href="../../bower_components/polymer/lib/utils/style-gather.html"><link rel="prefetch" href="../../bower_components/polymer/lib/elements/dom-module.html"><link rel="prefetch" href="../../bower_components/polymer/lib/mixins/property-effects.html"><link rel="prefetch" href="../../bower_components/polymer/lib/utils/path.html"><link rel="prefetch" href="../../bower_components/polymer/lib/mixins/property-accessors.html"><link rel="prefetch" href="../../bower_components/polymer/lib/utils/async.html"><link rel="prefetch" href="../../bower_components/polymer/lib/mixins/template-stamp.html"><link rel="prefetch" href="../../bower_components/polymer/polymer.html"><link rel="prefetch" href="../../bower_components/polymer/lib/legacy/legacy-element-mixin.html"><link rel="prefetch" href="../../bower_components/shadycss/apply-shim.html"><link rel="prefetch" href="../../bower_components/shadycss/apply-shim.min.js"><link rel="prefetch" href="../../bower_components/polymer/lib/mixins/gesture-event-listeners.html"><link rel="prefetch" href="../../bower_components/polymer/lib/utils/gestures.html"><link rel="prefetch" href="../../bower_components/polymer/lib/utils/debounce.html"><link rel="prefetch" href="../../bower_components/polymer/lib/utils/import-href.html"><link rel="prefetch" href="../../bower_components/polymer/lib/utils/render-status.html"><link rel="prefetch" href="../../bower_components/polymer/lib/utils/unresolved.html"><link rel="prefetch" href="../../bower_components/polymer/lib/legacy/polymer.dom.html"><link rel="prefetch" href="../../bower_components/polymer/lib/utils/flattened-nodes-observer.html"><link rel="prefetch" href="../../bower_components/polymer/lib/utils/array-splice.html"><link rel="prefetch" href="../../bower_components/polymer/lib/utils/flush.html"><link rel="prefetch" href="../../bower_components/polymer/lib/legacy/polymer-fn.html"><link rel="prefetch" href="../../bower_components/polymer/lib/legacy/class.html"><link rel="prefetch" href="../../bower_components/polymer/lib/legacy/templatizer-behavior.html"><link rel="prefetch" href="../../bower_components/polymer/lib/utils/templatize.html"><link rel="prefetch" href="../../bower_components/polymer/lib/mixins/mutable-data.html"><link rel="prefetch" href="../../bower_components/polymer/lib/elements/dom-bind.html"><link rel="prefetch" href="../../bower_components/polymer/lib/elements/dom-repeat.html"><link rel="prefetch" href="../../bower_components/polymer/lib/elements/array-selector.html"><link rel="prefetch" href="../../bower_components/polymer/lib/elements/custom-style.html"><link rel="prefetch" href="../../bower_components/shadycss/custom-style-interface.html"><link rel="prefetch" href="../../bower_components/shadycss/custom-style-interface.min.js"><link rel="prefetch" href="../../bower_components/polymer/lib/legacy/mutable-data-behavior.html"><link rel="prefetch" href="../../bower_components/iron-ajax/iron-request.html"><link rel="prefetch" href="../../bower_components/iron-jsonp-library/iron-jsonp-library.html"></head><body><dom-module id="wwg-map"><template><style>:host{display:block;font-family:Arial;overflow:hidden;}.outerContainer{display:flex;display:-webkit-flex;flex-direction:column;-webkit-flex-direction:column;}.innerContainer{display:flex;display:-webkit-flex;flex-direction:column;-webkit-flex-direction:column;}h2{font-size:14px;margin-top:0;}a{text-decoration:none;color:inherit;}.header{background:#04793e;padding:12px;}.header:after{position:absolute;content:url('images/header_back.png');z-index:10;right:-4px;top:50px;}.header .button{margin-left:-38px;}label{color:#d6cbbb;padding:12px;display:inline-block;font-size:12px;text-align:center;width:62px;}input{width:calc(100% - 16px);padding:10px 0 10px 10px;border:0;display:inline-block;border-radius:0;}select{padding:8px;font-size:12px;width:132px;border:0;border-radius:0;background:#fff url('images/dropdown_arrow.png') no-repeat;background-position:110px center;-webkit-appearance:none;-moz-appearance:none;}.dropdowns{border-left:1px solid #d6cbbb;margin-top:12px;}.list{padding:12px;background:#d6cbbb;}.card{background:#efece8;border:1px solid #cccccc;padding:12px;margin-bottom:12px;display:flex;display:-webkit-flex;flex-wrap:wrap;-webkit-flex-wrap:wrap;}.card:last-child{margin-bottom:0;}.marketInfo{flex:1;-webkit-flex:1;padding-right:12px;}.address{color:#666666;font-size:11px;}.hours, .season{font-size:12px;min-width:100%;margin-bottom:0;}.season{font-weight:bold;margin-bottom:-10px;}.typeContainer{text-align:right;}.typeLabel{color:#fff;font-size:11px;padding:6px;display:block;text-align:center;margin-bottom:6px;}.typeLabel.market{background:#d95740;width:calc(100% - 12px);}.typeLabel.csa{background:#f09150;}.button{background:#f4f4f4;border:1px solid #cccccc;padding:6px 7px;border-radius:3px;display:inline-block;outline:none;}.card .button{margin-left:2px;}.card .button:first-child{margin-left:0;}.button svg{width:16px;height:16px;vertical-align:middle;}span.tooltip, a.tooltip, button.tooltip{position:relative;display:inline-block;}span.tooltip span, a.tooltip span, button.tooltip span{position:absolute;font-size:13px;width:100px;color:#FFFFFF;background:#000000;height:30px;line-height:30px;text-align:center;visibility:hidden;border-radius:3px;}span.tooltip span:after, a.tooltip span:after, button.tooltip span:after{content:'';position:absolute;top:50%;left:100%;margin-top:-8px;width:0;height:0;border-left:8px solid #000000;border-top:8px solid transparent;border-bottom:8px solid transparent;}span:hover.tooltip span, a:hover.tooltip span, button:hover.tooltip span{visibility:visible;opacity:0.8;right:100%;top:50%;margin-top:-15px;margin-right:10px;z-index:999;}span.tooltip.csa span{padding:6px;line-height:14px;height:auto;width:140px;font-size:12px;}span.tooltip.csa span:after{top:16px;}@media (min-width: 414px){.button.tel{display:none;}.button.telPlaceholder{display:inline-block;}}@media (max-width: 413px){.button.tel{display:inline-block;}.button.telPlaceholder{display:none;}}@media (min-width: 736px){input{width:180px;}.dropdowns, .dropdown{display:inline-block;}.dropdowns{margin-left:32px;margin-top:0;}.header:after{top:-10px;}#map{width:60%;}.list{width:40%;height:100%;overflow:auto;}.innerContainer{overflow:hidden;flex-direction:row;-webkit-flex-direction:row;height:calc(100vh - 62px);}}@media (max-width: 735px){.list{height:calc(100vh - 223px);overflow-x:scroll;}#map{height:200px;}}</style><div class="outerContainer"><div class="header"><input id="search" placeholder="Address or Zipcode" type="text"> <button type="button" class="button tooltip" onclick="{{_getLocation}}"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 12 12" style="enable-background:new 0 0 12 12" xml:space="preserve"><path d="M6,3.8c-1.2,0-2.2,1-2.2,2.2s1,2.2,2.2,2.2s2.2-1,2.2-2.2S7.2,3.8,6,3.8z M10.9,5.5c-0.3-2.3-2.1-4.1-4.3-4.3V0H5.5v1.1
            	C3.2,1.4,1.4,3.2,1.1,5.5H0v1.1h1.1c0.3,2.3,2.1,4.1,4.3,4.3V12h1.1v-1.1c2.3-0.3,4.1-2.1,4.3-4.3H12V5.5C12,5.5,10.9,5.5,10.9,5.5z
            	 M6,9.8C3.9,9.8,2.2,8.1,2.2,6S3.9,2.2,6,2.2S9.8,3.9,9.8,6S8.1,9.8,6,9.8z"></path></svg> <span>my location</span></button><div class="dropdowns"><div class="dropdown"><label for="searchType">Search</label><select id="searchType" value="{{typeValue::change}}"><option value="" selected="">All Food Retailers</option><option value="market">Farmers Markets</option><option value="csa">CSAs</option><option value="farm">Farms</option></select></div><div class="dropdown"><label for="searchDistance">Within</label><select id="searchDistance" value="{{searchDistance::change}}"><option value="" selected="">Any Distance</option><option value="10">10 miles</option><option value="25">25 miles</option><option value="50">50 miles</option><option value="100">100 miles</option><option value="200">200 miles</option></select></div></div></div><iron-ajax id="marketData" auto="" url="https://sheets.googleapis.com/v4/spreadsheets/1KZih3C4gwp0-iyNrL_GGZhr90OuzqyAAQ6uaO6mEGmI/values/A2:J100" params="{&quot;key&quot;: &quot;AIzaSyBrEbVSGuOwOpnvrO9ETFCfcXdLSZfUKME&quot;}" handle-as="json" last-response="{{markets}}" debounce-duration="300"></iron-ajax><div class="innerContainer"><google-maps-api id="gMap" api-key="AIzaSyBrEbVSGuOwOpnvrO9ETFCfcXdLSZfUKME" version="3.29"></google-maps-api><div id="map"></div><div class="list"><template id="listTemplate" is="dom-repeat" items="{{marketsArr}}" as="market" filter="{{computeFilter(typeValue, searchDistance)}}" observe="distance"><div class="card"><div class="marketInfo"><h2><a href="{{market.website}}" target="_blank">{{market.title}}</a></h2><p class="address">{{market.street}}<br>{{market.city}}{{_getDistanceText(market.distance)}}</p></div><div class="typeContainer"><span class$="typeLabel {{_typeClass(market.type)}} tooltip">{{market.type}}<template is="dom-if" if="{{_csaCheck(market.type)}}"><span>A Community Supported Agriculture (CSA) share of produce is delivered weekly, or bi-weekly, to a convenient drop-off location in your neighborhood.</span></template></span><div><a class="tel button" href="tel:{{market.phone}}" target="_blank"><svg fill="#000000" height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg"><path d="M2.4,5.2c1,1.9,2.5,3.4,4.4,4.4l1.5-1.5C8.5,7.9,8.7,7.9,9,8c0.7,0.2,1.6,0.4,2.4,0.4C11.7,8.3,12,8.6,12,9v2.3
          c0,0.4-0.3,0.7-0.7,0.7C5.1,12,0,6.9,0,0.7C0,0.3,0.3,0,0.7,0H3c0.4,0,0.7,0.3,0.7,0.7C3.7,1.5,3.8,2.3,4,3c0.1,0.2,0,0.5-0.2,0.7
          L2.4,5.2z"></path></svg> </a><span class="telPlaceholder button tooltip"><svg fill="#000000" height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg"><path d="M2.4,5.2c1,1.9,2.5,3.4,4.4,4.4l1.5-1.5C8.5,7.9,8.7,7.9,9,8c0.7,0.2,1.6,0.4,2.4,0.4C11.7,8.3,12,8.6,12,9v2.3
          c0,0.4-0.3,0.7-0.7,0.7C5.1,12,0,6.9,0,0.7C0,0.3,0.3,0,0.7,0H3c0.4,0,0.7,0.3,0.7,0.7C3.7,1.5,3.8,2.3,4,3c0.1,0.2,0,0.5-0.2,0.7
          L2.4,5.2z"></path></svg> <span>{{market.phone}}</span> </span><a class="button tooltip" href="https://www.google.ca/maps/dir/my+location/{{market.street}}+{{market.city}}" target="_blank"><svg fill="#000000" height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg"><path d="M12,0L0,5v0.7l4.6,1.8L6.3,12H7L12,0z"></path></svg> <span>directions</span> </a><a class="button tooltip" href="{{market.website}}" target="_blank"><svg fill="#000000" height="12" viewBox="0 0 12 12" width="12" xmlns="http://www.w3.org/2000/svg"><path d="M6,0C2.7,0,0,2.7,0,6s2.7,6,6,6c3.3,0,6-2.7,6-6S9.3,0,6,0z M10.2,3.6H8.4C8.2,2.8,7.9,2.1,7.6,1.5
          C8.7,1.8,9.6,2.6,10.2,3.6z M6,1.2c0.5,0.7,0.9,1.5,1.1,2.4H4.9C5.1,2.7,5.5,1.9,6,1.2z M1.4,7.2C1.3,6.8,1.2,6.4,1.2,6
          s0.1-0.8,0.2-1.2h2c0,0.4-0.1,0.8-0.1,1.2s0,0.8,0.1,1.2H1.4z M1.8,8.4h1.8c0.2,0.8,0.5,1.5,0.8,2.1C3.3,10.2,2.4,9.4,1.8,8.4z
           M3.6,3.6H1.8c0.6-1,1.5-1.8,2.6-2.1C4.1,2.1,3.8,2.8,3.6,3.6z M6,10.8c-0.5-0.7-0.9-1.5-1.1-2.4h2.3C6.9,9.3,6.5,10.1,6,10.8z
           M7.4,7.2H4.6C4.5,6.8,4.5,6.4,4.5,6s0-0.8,0.1-1.2h2.8C7.5,5.2,7.5,5.6,7.5,6S7.5,6.8,7.4,7.2z M7.6,10.5c0.4-0.7,0.6-1.4,0.8-2.1
          h1.8C9.6,9.4,8.7,10.2,7.6,10.5z M8.6,7.2c0-0.4,0.1-0.8,0.1-1.2s0-0.8-0.1-1.2h2c0.1,0.4,0.2,0.8,0.2,1.2s-0.1,0.8-0.2,1.2H8.6z"></path></svg> <span>website</span></a></div></div><template is="dom-if" if="{{market.season}}"><p class="season">{{market.season}}</p></template><p class="hours">{{market.hours}}</p></div></template></div></div></div></template><script>var WwgMap=function(c){function d(){return babelHelpers.classCallCheck(this,d),babelHelpers.possibleConstructorReturn(this,(d.__proto__||Object.getPrototypeOf(d)).apply(this,arguments))}return babelHelpers.inherits(d,c),babelHelpers.createClass(d,[{key:'ready',value:function(){var g=this;babelHelpers.get(d.prototype.__proto__||Object.getPrototypeOf(d.prototype),'ready',this).call(this),this.$.gMap.addEventListener('api-load',function(){window.WwgMapObj=new google.maps.Map(g.$.map,{zoom:10,center:{lat:33.790586,lng:-84.37395},fullscreenControlOptions:{position:5},zoomControlOptions:{position:4},mapTypeControl:!1,streetViewControl:!1}),g.addEventListener('marketsDataReady',function(j){g.createMarkers(j.detail.marketsData)});var h=new google.maps.places.Autocomplete(g.$.search);google.maps.event.addListener(h,'place_changed',function(){if(g._moveToLocation(),g.$.search.value){var j=new google.maps.DistanceMatrixService,k=[],l=[],m=g.marketsArr.map(function(q){return q.street+' '+q.city});g.numSegments=Math.ceil(m.length/25);var o=function(){setTimeout(function(){return!0},1e3)},p=function q(r){1>r?(l=k.map(function(s,t){var u=Object.assign({},g.marketsArr[t]);return u.distance=s.distance.text,u}),l.sort(function(s,t){var u=parseInt(s.distance.replace(' mi','')),v=parseInt(t.distance.replace(' mi',''));return u<v?-1:u>v?1:0}),g.marketsArr=l,g.clearMarkers(),g.createMarkers(l),g.$.listTemplate.render()):j.getDistanceMatrix({origins:[g.$.search.value],destinations:m.slice(25*(r-1),25*r),travelMode:'DRIVING',unitSystem:google.maps.UnitSystem.IMPERIAL},function(s,t){'OK'===t&&(k.unshift.apply(k,babelHelpers.toConsumableArray(s.rows[0].elements)),o(),q(r-1)),'UNKNOWN_ERROR'===t&&(o(),q(r-1))})};p(g.numSegments)}})})}},{key:'clearMarkers',value:function(){this.markers.forEach(function(g){g.setMap(null)})}},{key:'createMarkers',value:function(g){var h=new google.maps.InfoWindow,j=[];g.map(function(k){var l=new google.maps.LatLng(parseFloat(k.lat),parseFloat(k.lng)),m=new google.maps.Marker({position:l,map:window.WwgMapObj,title:k.title,type:k.type,distance:k.distance});j.push(m),google.maps.event.addListener(m,'click',function(o,p){return function(){h.setContent('\n                <div style="max-width:250px;">\n                  <h2 style="font-size: 15px; margin-top: 0;">'+p.title+'</h2>\n                  <p style="color: #666666; font-size: 11px;">'+p.street+'<br>'+p.city+' - <a style="color: inherit;" href="https://www.google.ca/maps/dir/my+location/'+p.street+'+'+p.city+'" target="_blank">Directions</a></p>\n                  <p style="font-size: 12px;">'+p.hours+'</p>\n                </div>\n                '),h.open(window.WwgMapObj,o)}}(m,k))}),this.markers=j}},{key:'_marketDataChanged',value:function(g){this.marketsArr=g.values.map(function(h){return{title:h[0],type:h[1],street:h[2],city:h[3],season:h[4],hours:h[5],website:h[6],phone:h[7],lat:h[8],lng:h[9],distance:''}}),this.dispatchEvent(new CustomEvent('marketsDataReady',{detail:{marketsData:this.marketsArr}}))}},{key:'_typeClass',value:function(g){var h;return'Farmers Market'===g?h='market':'CSA'===g?h='csa':'Farm'===g?h='farm':void 0,h}},{key:'_csaCheck',value:function(g){return'CSA'===g}},{key:'_getLocation',value:function(){if(!navigator.geolocation)return void alert('Geolocation is not supported by your browser');console.log('Locating\u2026'),navigator.geolocation.getCurrentPosition(function(k){var l=k.coords.latitude,m=k.coords.longitude;window.WwgMapObj.setCenter({lat:l,lng:m}),window.WwgMapObj.setZoom(14)},function(k){alert('Unable to retrieve your location',k)})}},{key:'_moveToLocation',value:function(g,h){if(g&&h)window.WwgMapObj.setCenter({lat:g,lng:h});else{var j=new google.maps.Geocoder;j.geocode({address:this.$.search.value},function(k,l){'OK'===l&&window.WwgMapObj.setCenter({lat:k[0].geometry.location.lat(),lng:k[0].geometry.location.lng()}),'UNKNOWN_ERROR'===l&&console.log(k)})}window.WwgMapObj.zoom=14}},{key:'_getDistanceText',value:function(g){return''===g?null:' \u2022 '+g}},{key:'computeFilter',value:function(g,h){var j=this;return g||h?function(k){var l=k.distance;return g&&h&&''!==j.$.search.value?(j.markers.forEach(function(m){var o=m.distance;j._typeClass(m.type)===g&&parseInt(o.substring(0,o.length-3))<h?m.setVisible(!0):m.setVisible(!1)}),j._typeClass(k.type)===g&&parseInt(l.substring(0,l.length-3))<h):g&&!h?(j.markers.forEach(function(m){j._typeClass(m.type)===g?m.setVisible(!0):m.setVisible(!1)}),j._typeClass(k.type)===g):!g&&h&&''!==j.$.search.value?(j.markers.forEach(function(m){var o=m.distance;parseInt(o.substring(0,o.length-3))<h?m.setVisible(!0):m.setVisible(!1)}),parseInt(l.substring(0,l.length-3))<h):void 0}:(this.markers.forEach(function(k){k.setVisible(!0)}),null)}}],[{key:'is',get:function(){return'wwg-map'}},{key:'properties',get:function(){return{typeValue:{type:String},markets:{type:Object},addrLookupArr:{type:Array},addrResultsArr:{type:Array,value:[]}}}},{key:'observers',get:function(){return['_marketDataChanged(markets)']}}]),d}(Polymer.Element);window.customElements.define(WwgMap.is,WwgMap);</script></dom-module></body></html>